<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Crypto Wallet - Assets</title>
  <link rel="stylesheet" href="css/coinbase-style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <style>
    .assets-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px;
      background-color: var(--background-color);
    }
    
    .wallet-selector {
      display: flex;
      align-items: center;
      gap: 8px;
      margin: 16px;
    }
    
    .wallet-icon {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background-color: #ff5722;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
    }
    
    .wallet-name {
      font-weight: 500;
      font-size: 18px;
    }
    
    .main-balance {
      font-size: 32px;
      font-weight: 700;
      margin: 16px;
    }
    
    .action-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 8px;
      padding: 0 16px 24px;
    }
    
    .action-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
    }
    
    .action-icon {
      width: 56px;
      height: 56px;
      border-radius: 16px;
      background-color: rgba(255, 255, 255, 0.05);
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--primary-color);
      font-size: 20px;
    }
    
    .action-label {
      font-size: 14px;
    }
    
    .asset-tabs {
      display: flex;
      padding: 0 16px;
      border-bottom: 1px solid var(--border-color);
    }
    
    .asset-tab {
      padding: 12px 24px;
      font-weight: 500;
      color: var(--text-secondary);
      position: relative;
    }
    
    .asset-tab.active {
      color: var(--text-color);
    }
    
    .asset-tab.active::after {
      content: "";
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 2px;
      background-color: var(--text-color);
    }
    
    .token-list {
      padding: 0;
    }
    
    .token-item {
      display: flex;
      align-items: center;
      padding: 16px;
      border-bottom: 1px solid var(--border-color);
    }
    
    .token-icon {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      margin-right: 16px;
      overflow: hidden;
    }
    
    .token-info {
      flex: 1;
    }
    
    .token-name {
      font-weight: 600;
      font-size: 16px;
    }
    
    .token-price {
      display: flex;
      align-items: center;
      gap: 8px;
      color: var(--text-secondary);
      font-size: 14px;
    }
    
    .token-change {
      color: var(--negative-color);
    }
    
    .token-change.positive {
      color: var(--positive-color);
    }
    
    .token-balance {
      text-align: right;
    }
    
    .token-amount {
      font-weight: 600;
      font-size: 16px;
    }
    
    .token-value {
      color: var(--text-secondary);
      font-size: 14px;
    }
    
    .sort-button {
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--text-secondary);
      margin-right: 8px;
    }
  </style>
</head>

  <div class="app-container">
    <!-- Wallet Header -->
    <div class="wallet-header">
      <div class="wallet-address">
        <div class="wallet-avatar">
          <i class="fas fa-skull"></i>
        </div>
        <div class="wallet-id">0xFA...8EdD</div>
        <i class="fas fa-chevron-down"></i>
      </div>
      <div class="header-actions">
        <button class="header-action">
          <i class="fas fa-qrcode"></i>
        </button>
        <button class="header-action">
          <i class="fas fa-sun"></i>
          <span class="notification-badge">1</span>
        </button>
      </div>
    </div>

    <!-- Balance -->
    <div class="balance-container">
      <h1 class="balance-amount" id="balanceAmount">$0</h1>
    </div>

    <!-- Action Buttons -->
    <div class="action-buttons">
      <a href="#" class="action-btn primary">Buy</a>
      <a href="#" class="action-btn secondary">Swap</a>
      <a href="cashout.html" class="action-btn secondary">Cash out</a>
    </div>

    <!-- Tabs -->
    <div class="tabs-container">
      <div class="tabs">
        <button class="tab-btn active">Crypto</button>
        <button class="tab-btn">NFTs</button>
        <button class="tab-btn">DeFi</button>
        <button class="tab-btn">Transactions</button>
      </div>
    </div>

    <!-- Network Filter -->
    <div class="network-filter">
      <button class="network-dropdown">
        All networks
        <i class="fas fa-chevron-down"></i>
      </button>
    </div>

    <!-- Token List -->
    <div class="token-list" id="tokenList">
      <!-- BNB Token -->
      <div class="token-item" data-token="BNB">
        <div class="token-icon">
          <img src="img/bnb.png" alt="BNB" onerror="this.src='data:image/svg+xml;utf8,<svg xmlns=\'http://www.w3.org/2000/svg\' width=\'40\' height=\'40\' viewBox=\'0 0 24 24\' fill=\'%23F3BA2F\' stroke=\'%23FFFFFF\' stroke-width=\'1\'><circle cx=\'12\' cy=\'12\' r=\'10\'/><path d=\'M8 12h8M12 8v8\' stroke=\'%23FFFFFF\' stroke-width=\'0\'/></svg>'">
        </div>
        <div class="token-info">
          <div class="token-name">BNB</div>
          <div class="token-change">
            <i class="fas fa-arrow-up"></i>
            1.37%
          </div>
        </div>
        <div class="token-balance">
          <div class="token-value">$0.46</div>
          <div class="token-amount">0.000773 BNB</div>
        </div>
      </div>

      <!-- TRX Token -->
      <div class="token-item" data-token="TRX">
        <div class="token-icon">
          <img src="img/trx.png" alt="TRX" onerror="this.src='data:image/svg+xml;utf8,<svg xmlns=\'http://www.w3.org/2000/svg\' width=\'40\' height=\'40\' viewBox=\'0 0 24 24\' fill=\'%23FF0000\' stroke=\'%23FFFFFF\' stroke-width=\'1\'><circle cx=\'12\' cy=\'12\' r=\'10\'/><path d=\'M8 12h8M12 8v8\' stroke=\'%23FFFFFF\' stroke-width=\'0\'/></svg>'">
        </div>
        <div class="token-info">
          <div class="token-name">TRX</div>
          <div class="token-change">
            <i class="fas fa-arrow-up"></i>
            0.06%
          </div>
        </div>
        <div class="token-balance">
          <div class="token-value">$0.2517</div>
          <div class="token-amount" id="trxAmount">10.00 TRX</div>
        </div>
      </div>

      <!-- USDT Token -->
      <div class="token-item" data-token="USDT">
        <div class="token-icon">
          <img src="img/usdt.png" alt="USDT" onerror="this.src='data:image/svg+xml;utf8,<svg xmlns=\'http://www.w3.org/2000/svg\' width=\'40\' height=\'40\' viewBox=\'0 0 24 24\' fill=\'%2326A17B\' stroke=\'%23FFFFFF\' stroke-width=\'1\'><circle cx=\'12\' cy=\'12\' r=\'10\'/><path d=\'M8 12h8M12 8v8\' stroke=\'%23FFFFFF\' stroke-width=\'0\'/></svg>'">
        </div>
        <div class="token-info">
          <div class="token-name">USDT</div>
          <div class="token-change">
            <i class="fas fa-minus"></i>
            0.00%
          </div>
        </div>
        <div class="token-balance">
          <div class="token-value">$1.00</div>
          <div class="token-amount" id="usdtAmount">1000.00 USDT</div>
        </div>
      </div>

      <!-- USDC Token -->
      <div class="token-item" data-token="USDC">
        <div class="token-icon">
          <img src="img/usdc.png" alt="USDC" onerror="this.src='data:image/svg+xml;utf8,<svg xmlns=\'http://www.w3.org/2000/svg\' width=\'40\' height=\'40\' viewBox=\'0 0 24 24\' fill=\'%232775CA\' stroke=\'%23FFFFFF\' stroke-width=\'1\'><circle cx=\'12\' cy=\'12\' r=\'10\'/><path d=\'M8 12h8M12 8v8\' stroke=\'%23FFFFFF\' stroke-width=\'0\'/></svg>'">
        </div>
        <div class="token-info">
          <div class="token-name">USDC</div>
          <div class="token-change">
            <i class="fas fa-arrow-up"></i>
            0.01%
          </div>
        </div>
        <div class="token-balance">
          <div class="token-value">$1.01</div>
          <div class="token-amount" id="usdcAmount">1000.00 USDC</div>
        </div>
      </div>

      <!-- SOL Token -->
      <div class="token-item" data-token="SOL">
        <div class="token-icon">
          <img src="img/sol.png" alt="SOL" onerror="this.src='data:image/svg+xml;utf8,<svg xmlns=\'http://www.w3.org/2000/svg\' width=\'40\' height=\'40\' viewBox=\'0 0 24 24\' fill=\'%239945FF\' stroke=\'%23FFFFFF\' stroke-width=\'1\'><circle cx=\'12\' cy=\'12\' r=\'10\'/><path d=\'M8 12h8M12 8v8\' stroke=\'%23FFFFFF\' stroke-width=\'0\'/></svg>'">
        </div>
        <div class="token-info">
          <div class="token-name">SOL</div>
          <div class="token-change">
            <i class="fas fa-arrow-up"></i>
            1.41%
          </div>
        </div>
        <div class="token-balance">
          <div class="token-value">$126.54</div>
          <div class="token-amount" id="solAmount">0.00 SOL</div>
        </div>
      </div>

      <!-- ETH Token -->
      <div class="token-item" data-token="ETH">
        <div class="token-icon">
          <img src="img/eth.png" alt="ETH" onerror="this.src='data:image/svg+xml;utf8,<svg xmlns=\'http://www.w3.org/2000/svg\' width=\'40\' height=\'40\' viewBox=\'0 0 24 24\' fill=\'%23627EEA\' stroke=\'%23FFFFFF\' stroke-width=\'1\'><circle cx=\'12\' cy=\'12\' r=\'10\'/><path d=\'M8 12h8M12 8v8\' stroke=\'%23FFFFFF\' stroke-width=\'0\'/></svg>'">
        </div>
        <div class="token-info">
          <div class="token-name">ETH</div>
          <div class="token-change">
            <i class="fas fa-arrow-up"></i>
            4.35%
          </div>
        </div>
        <div class="token-balance">
          <div class="token-value">$3452.78</div>
          <div class="token-amount" id="ethAmount">0.00 ETH</div>
        </div>
      </div>

      <!-- BTC Token -->
      <div class="token-item" data-token="BTC">
        <div class="token-icon">
          <img src="img/btc.png" alt="BTC" onerror="this.src='data:image/svg+xml;utf8,<svg xmlns=\'http://www.w3.org/2000/svg\' width=\'40\' height=\'40\' viewBox=\'0 0 24 24\' fill=\'%23F7931A\' stroke=\'%23FFFFFF\' stroke-width=\'1\'><circle cx=\'12\' cy=\'12\' r=\'10\'/><path d=\'M8 12h8M12 8v8\' stroke=\'%23FFFFFF\' stroke-width=\'0\'/></svg>'">
        </div>
        <div class="token-info">
          <div class="token-name">BTC</div>
          <div class="token-change">
            <i class="fas fa-arrow-up"></i>
            3.2%
          </div>
        </div>
        <div class="token-balance">
          <div class="token-value">$65432.21</div>
          <div class="token-amount" id="btcAmount">0.00 BTC</div>
        </div>
      </div>

      <!-- POL Token -->
      <div class="token-item" data-token="POL">
        <div class="token-icon">
          <img src="img/pol.png" alt="POL" onerror="this.src='data:image/svg+xml;utf8,<svg xmlns=\'http://www.w3.org/2000/svg\' width=\'40\' height=\'40\' viewBox=\'0 0 24 24\' fill=\'%238247E5\' stroke=\'%23FFFFFF\' stroke-width=\'1\'><circle cx=\'12\' cy=\'12\' r=\'10\'/><path d=\'M8 12h8M12 8v8\' stroke=\'%23FFFFFF\' stroke-width=\'0\'/></svg>'">
        </div>
        <div class="token-info">
          <div class="token-name">POL</div>
          <div class="token-change">
            <i class="fas fa-arrow-down"></i>
            -0.96%
          </div>
        </div>
        <div class="token-balance">
          <div class="token-value">$0.78</div>
          <div class="token-amount" id="polAmount">0.00 POL</div>
        </div>
      </div>
    </div>
    <br>
    <br>

    <!-- Bottom Navigation -->
    <nav class="bottom-nav">
      <a href="dashboard.html" class="nav-item">
        <i class="fas fa-home"></i>
      </a>
      <a href="profile.html" class="nav-item">
        <i class="fas fa-user"></i>
      </a>
      <a href="send.html" class="nav-item">
        <i class="fas fa-exchange-alt"></i>
      </a>
      <a href="defi-wallet.html" class="nav-item active">
        <i class="fas fa-wallet"></i>
      </a>
    </nav>

    <!-- Home Indicator -->
    <div class="home-indicator"></div>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      // Check if user is logged in
      const currentUser = JSON.parse(localStorage.getItem("currentUser"))
      const token = localStorage.getItem("token")

      if (!currentUser || !token) {
        // Redirect to login if not logged in
        window.location.href = "index.html"
        return
      }

      // Apply dark mode if enabled
      const isDarkMode = localStorage.getItem("darkMode") === "true"
      if (isDarkMode) {
        document.body.classList.add("dark-mode")
      }

      // Load user data and balances
      loadUserData()

      // Set up polling for balance updates - check every 10 seconds
      setInterval(() => {
        refreshBalances()
      }, 10000)

      // Helper functions
      function loadUserData() {
        // Update main balance display
        const balanceAmount = document.getElementById("balanceAmount")
        if (balanceAmount) {
          balanceAmount.textContent = `$${formatNumber(currentUser.balance || 0)}`
        }

        // Update token balances
        updateTokenBalance("trx", currentUser.trxBalance || 0)
        updateTokenBalance("usdt", currentUser.usdtBalance || 0)
        updateTokenBalance("usdc", currentUser.usdcBalance || 0)
        updateTokenBalance("bnb", currentUser.bnbBalance || 0)
        updateTokenBalance("sol", currentUser.solBalance || 0)
        updateTokenBalance("eth", currentUser.ethBalance || 0)
        updateTokenBalance("btc", currentUser.btcBalance || 0)
        updateTokenBalance("pol", currentUser.polBalance || 0)
      }

      function updateTokenBalance(token, balance) {
        const amountElement = document.getElementById(`${token}Amount`)
        
        if (amountElement) {
          amountElement.textContent = `${balance} ${token.toUpperCase()}`
        }
        
        // Get token price from API or use fixed values for demo
        const prices = {
          "trx": 0.2517,
          "usdt": 1.00,
          "usdc": 1.01,
          "bnb": 610.38,
          "sol": 126.54,
          "eth": 3452.78,
          "btc": 65432.21,
          "pol": 0.78
        }
        
        const price = prices[token] || 1
        const value = balance * price
        
        const valueElement = document.querySelector(`.token-item[data-token="${token.toUpperCase()}"] .token-value`)
        if (valueElement) {
          valueElement.textContent = `$${formatNumber(value)}`
        }
      }

      // Function to refresh balances from the server
      function refreshBalances() {
        fetch("/api/users/profile", {
          headers: {
            Authorization: `Bearer ${token}`,
          },
        })
          .then((response) => response.json())
          .then((data) => {
            if (data.success) {
              // Update the current user data in localStorage
              const updatedUser = data.user

              // Only update if there are actual changes to avoid unnecessary re-renders
              if (JSON.stringify(updatedUser) !== JSON.stringify(currentUser)) {
                localStorage.setItem("currentUser", JSON.stringify(updatedUser))

                // Update the UI with new balance
                const balanceValue = document.getElementById("balanceValue")
                if (balanceValue) {
                  if (updatedUser.balance > 0) {
                    balanceValue.textContent = formatNumber(updatedUser.balance)
                  } else {
                    balanceValue.textContent = "<0.00001"
                  }
                }

                // Update token balances
                updateTokenBalance("trx", updatedUser.trxBalance || 0)
                updateTokenBalance("usdt", updatedUser.usdtBalance || 0)
                updateTokenBalance("usdc", updatedUser.usdcBalance || 0)
                updateTokenBalance("bnb", updatedUser.bnbBalance || 0)
                updateTokenBalance("sol", updatedUser.solBalance || 0)
                updateTokenBalance("eth", updatedUser.ethBalance || 0)
                updateTokenBalance("btc", updatedUser.btcBalance || 0)
                updateTokenBalance("pol", updatedUser.polBalance || 0)
              }
            }
          })
          .catch((error) => {
            console.error("Error refreshing balances:", error)
          })
      }

      function formatNumber(num) {
        if (num === undefined || num === null) return "0.00"
        return Number.parseFloat(num).toLocaleString("en-US", {
          minimumFractionDigits: 2,
          maximumFractionDigits: 2,
        })
      }

      // Token item click handler
      const tokenItems = document.querySelectorAll(".token-item")
      tokenItems.forEach((item) => {
        item.addEventListener("click", function() {
          const tokenType = this.getAttribute("data-token")
          window.location.href = `token-detail.html?token=${tokenType}`
        })
      })
    })
  </script>
</body>
</html>

